<!DOCTYPE html>
<html>
	<head>
		<title>시간 관리자</title>
		<link rel="icon" type="image/png" href="../favicon.png">
		<link rel="stylesheet" href="../css/main.css">
		<link rel="stylesheet" href="../css/index.css">
		<script src="../script/jquery.js"></script>
		<script src="../script/modules.js"></script>
	</head>
	<body>
		<audio src="../sound/alarm.mp3" id="alarm" style="display:none"></audio>
		<h1 style="width:100vw;text-align:center">
			시간 관리자
		</h1>
		<div class="center timerbody">
			<div class="timer"><div class="content"></div></div>
			<span>×</span>
			<span class="multi-meterA">00</span>
			<span style="font-family:sans-serif;">.</span>
			<span class="multi-meterB">0</span>
		</div>
		<div class="center" style="height: 10vw; vertical-align: top;">
			<button id="cpt" color="#FF6666">놀기</button>
			<button id="mc" color="#55DDDD">마크</button>
		</div>
		<div class="center">
			<h1 style="display:inline;font-size:5em;" class="timeA">----</h1>
			<h1 style="display:inline;font-size:3em;" class="timeB">-</h1>
		</div>
		<div class="center">
			<div class="selecter" color="#FF6666">
			<div id="blocker"></div>
				<h1>설정</h1>
				<p>놀기 모드에서만 적용되는 설정입니다.</p>
				<label><input type="checkbox" id="hw">숙제 여부</label>
				<label><input type="checkbox" id="pms">허락 받음</label><br>
				<label><input type="radio" id="cpthw" name="special">컴퓨터용 숙제</label>
				<label><input type="radio" id="yt" name="special" checked>유튜브</label>
				<label><input type="radio" id="ot" name="special">기타</label><br>
				<label class="grayif">제한 시간 <input type="number" id="time" value="60" class="small grayif">분</label>
			</div>
		</div>
		<footer>
			<div class="center">
				<!--<a href="statics.html"><button id="stt" color="#AAAAAA">통계</button></a>!-->
				<a href="time.html"><button id="time" color="#EECC00">관리</button></a>
			</div>
			<p class="center version"></p>
		</footer>
	</body>
	<script>
		var multifly=0;
		var status="idle";
		var prevS="idle";
		var time=0;
		var timeLimit=10;
		var $element;
		var func;
		var alarm;
		
		function playAlarm() {
			document.querySelector("#alarm").play();
		}
		
		// localStorage.time = *value*
		$("#cpt").click(function() {
			if (status!="idle") {
				if (status=="computer") {
					status="idle";
				}
				return;
			}
			if ($("#cpthw").is(":checked")) {
				multifly=0;
			} else if ($("#hw").is(":checked")) {
				if ($("#pms").is(":checked")) {
					multifly=0;
				} else {
					multifly=0.5;
				}
			} else {
				if ($("#pms").is(":checked")) {
					multifly=2;
				} else {
					multifly=6;
				}
			}
			if ($("#yt").is(":checked")) {
				multifly*=5;
			}
			status="computer";
		});
		$("#mc").click(function() {
			if (status!="idle") {
				if (status=="minecraft") {
					status="idle";
				}
				return;
			}
			if (localStorage.time>0) {
				$(".selecter #blocker").css("display","block");
				$(".selecter").addClass("fixed-selecter");
				
				multifly=1;
				status="minecraft";
			}
		});
		
		function check() {
			$(".multi-meterA").text(pad(Math.floor(multifly),2));
			$(".multi-meterB").text(Math.floor(multifly%1*10));
			if (localStorage.time<0) {
				$("#mc").attr("color", "#FFFFFF");
			} else {
				$("#mc").attr("color","#55DDDD");
			}
			if (!$("#pms").is(":checked")) {
				$(".grayif").attr("style","color: #AAAAAA !important");
				$("#time").attr("readonly","true");
				if ($("#hw").is(":checked")) {
					$("#time").val(45);
				} else {
					$("#time").val(10);
				}
			} else {
				$(".grayif").attr("style","color: #000000 !important");
				$("#time").removeAttr("readonly");
			}
			if (status=="idle") {
				if ($("#cpthw").is(":checked")) {
					$("#cpt").attr("color","#880088");
					$("#cpt").text("숙제");
				} else {
					$("#cpt").attr("color","#FF6666");
					$("#cpt").text("놀기");
				}
			}
			if (prevS!="computer" && status=="computer") {
				prevS="computer";
				$("#cpt").text("그만두기");
				$("#cpt").attr("color","#AAAAAA");
				$(".selecter #blocker").css("display","block");
				$(".selecter").addClass("fixed-selecter");
				time=0;
				timeLimit=$("#time").val();
				func=setInterval(increaseTime,13);
			} else if (prevS!="minecraft" && status=="minecraft") {
				prevS="minecraft";
				$("#mc").text("그만두기");
				$("#mc").attr("color","#AAAAAA");
				$(".selecter #blocker").css("display","block");
				$(".selecter").addClass("fixed-selecter");
				time=0;
				timeLimit=$("#time").val();
				func=setInterval(increaseTime,13);
			} else if (prevS!="idle" && status=="idle") {
				multifly=0;
				time=0;
				prevS="idle";
				$("#mc").text("마크");
				$("#cpt").attr("color","#FF6666");
				if ($("#cpthw").is(":checked")) {
					$("#cpt").attr("color","#880088");
					$("#cpt").text("숙제");
				} else {
					$("#cpt").attr("color","#FF6666");
					$("#cpt").text("놀기");
				}
				if (localStorage.time>0) {
					$("#mc").attr("color", "#55DDDD");
				} else {
					$("#mc").attr("color", "#FFFFFF");
				}
				$(".selecter #blocker").css("display","none");
				$(".selecter").removeClass("fixed-selecter");
				console.log(alarm);
				clearInterval(func);
				clearInterval(alarm);
				$(".content").css("width","0vw");
			}
		}
		
		function increaseTime() {
			time+=0.013;
			localStorage.time -= 0.013*multifly;
			if (time >= timeLimit*60 && status=="computer") {
				$(".content").css("width","70.5vw");
				if (localStorage.time < 0) {
					$(".content").css("background-color", "#FFFFFF");
				} else {
					$(".content").css("background-color", "#000000");
				}
				if ($("#cpthw").is(":checked")) {
					multifly=0;
				} else if ($("#hw").is(":checked")) {
					if ($("#pms").is(":checked")) {
						multifly=0.5;
					} else {
						multifly=1.5;
					}
				} else {
					if ($("#pms").is(":checked")) {
						multifly=6;
					} else {
						multifly=10;
					}
				}
				if ($("#yt").is(":checked")) {
					multifly*=5;
				}
			} else {
				if (status=="computer") {
					$(".content").css("width",time/timeLimit*70.5/60+"vw");
				}
				if (localStorage.time < 0) {
					if (time/timeLimit/60 <= 0.7) {
						var temp=Math.floor(time/timeLimit/60*218.6+102);
						$(".content").css("background-color", "rgb(255,"+temp+","+temp+")");
					} else {
						$(".content").css("background-color", "rgb(255,255,255)");
					}
				} else {
					if (time/timeLimit/60 <= 0.7) {
						var temp=Math.floor(time/timeLimit/60*-364.3+255);
						console.log(temp);
						$(".content").css("background-color", "rgb("+temp+","+temp+","+temp+")");
					} else {
						$(".content").css("background-color", "rgb(0,0,0)");
					}
				}
			}
			if (status=="minecraft" && localStorage.time<=0) {
				multifly=0;
				localStorage.time=-0.01;
				alarm=setInterval(playAlarm,1500);
				clearInterval(func);
				return;
			}
		}
		setInterval(loop,13);
		setInterval(check,53);
	</script>
</html>