<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="style.css">
		<script src="jquery.js"></script>
	</head>
	<body>
		<div class="overlay">
			<div style="height:15vh"></div>
			<div class="all-inline" style="zoom: 1.5">
				<h5 class="mono" id="msg">
					완공까지
				</h5>
				<br>
				<h1 id="tday" class="mono">
					00000
				</h1>
				<h6 class="mono">
					일
				</h6>
				<h2 id="sec" class="mono">
					00000
				</h2>
				<h6 class="mono">
					초
				</h6>
				<h3 id="msec" class="mono">
					000
				</h3>
				<br>
				<h5 class="mono">
					벽돌 하나
				</h5>
				<br>
				<h1 id="bday" class="mono">
					0
				</h1>
				<h6 class="mono">
					일
				</h6>
				<h2 id="bsec" class="mono">
					00000
				</h2>
				<h6 class="mono">
					초
				</h6>
				<h3 id="bmsec" class="mono">
					000
				</h3>
				<br>
			</div>
			<a href="index.html" style="text-decoration:none; zoom:1.5;"><button id="start">
				<image style="height:50px; margin: 5px;" src="hammer.png" alt="킹작권"></image>
				<p style="font-weight: bold; color:#00BBFF;">
					공사 중단
				</p>
			</button></a>
		</div>
		<div class="wall"></div>
	</body>
	<script>
		var i,j;
		var brickNum=0;
		var $line, $brick;
		for (i=0; i<50; i++) {
			$line=$("<div>");
			$line.addClass("line");
			if (i%2==1) {
				$line.addClass("even");
				brickNum++;
				$line.append($("<brick num="+brickNum+">"));
			}
			for (j=0; j<50; j++) {
				brickNum++;
				$brick=$("<brick num="+brickNum+">");
				$line.append($brick);
			}
			$(".wall").append($line);
		}
		$(".even brick:nth-child(1)").addClass("half");
		$(".even brick:nth-child(1)").addClass("no-left");
		$(".even brick:nth-last-child(1)").addClass("half");
		$(".even brick:nth-last-child(1)").addClass("no-right");
		const p = new URLSearchParams(window.location.search);
		if (p.get('y') == null || p.get('m') == null || p.get('d') == null || p.get('h') == null) {
			alert("양식을 기입해 주십시오");
			window.location="index.html";
		}
		const endDate = new Date(p.get('y'),p.get('m')-1,p.get('d'),p.get('h'));
		const seconds=p.get('s');
		var bricks;
		var remain;
		var lines;
		function loop() {
			remain=endDate-new Date();
			if (remain>seconds*1000) {
				remain-=seconds*1000;
				$("brick").css("opacity","0");
				$("#msg").text("공사 시작까지");
				$("#tday").text(("00000" + Math.floor(remain/86400000)).slice(-5));
				$("#sec").text(("00000" + Math.floor(remain/1000)%86400).slice(-5));
				$("#msec").text(("000" + remain%1000).slice(-3));
				return;
			}
			if (remain>=0) {
				$("#tday").text(("00000" + Math.floor(remain/86400000)).slice(-5));
				$("#sec").text(("00000" + Math.floor(remain/1000)%86400).slice(-5));
				$("#msec").text(("000" + remain%1000).slice(-3));
			} else {
				$("brick").css("opacity","1");
				$("#tday,#sec,#bsec").text("00000");
				$("#msec,#bmsec").text("000");
				$("#bday").text("0");
				return;
			}
			bricks=((1-remain/seconds/1000))*2500;
			lines=Math.floor(bricks/50)+1;
			$(".wall .line:nth-child(-n+"+(lines-1)+") brick").css("opacity","1");
			bricks %= 50;
			remain=0;
			if (lines%2==0) {
				if (bricks%50==0) {
					remain=-0.5/2500*seconds*1000;
				}
				bricks+=0.5;
			}
			remain+=(1-bricks%1)/2500*seconds*1000;
			bricks=Math.floor(bricks);
			$(".wall .line:nth-child("+lines+") brick").css("opacity","0");
			$(".wall .line:nth-child("+lines+") brick:nth-child(-n+"+bricks+")").css("opacity","1");
			$(".wall .line:nth-child(n+"+(lines+1)+") brick").css("opacity","0");
			$("#bday").text(("0" + Math.floor(remain/86400000)).slice(-1));
			$("#bsec").text(("00000" + Math.floor(remain/1000)%86400).slice(-5));
			$("#bmsec").text(("000" + remain%1000).slice(-3));
			console.log(remain);
		}
		setInterval(loop, 53);
		// RLAFFICIAL LOOP TIME
		// 13ms 17ms 53ms 193ms
	</script>
</html>