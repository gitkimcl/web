<!DOCTYPE html>
<html>
    <head>
        <title>Dobby timer</title>
        <link rel="icon" href="icon.png">
        <link rel="stylesheet" href="style.css">
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    </head>
    <body>
        <img src="logo.svg" id="logo">
        <p id="name">311307</p>
        <div id="top-container">
            <p id="date-display"></p>
            <p id="week-display"></p>
        </div>
        <div id="middle-container">
            <div id="day-display">
                <span id="day-display-text">5;00</span>
            </div>
            <div id="hour-progress">
                <span id="hour-progress-bg"></span>
                <span id="hour-progress-fg"></span>
            </div>
            <div id="timer">
                <div class="timer-text-container">
                    <span class="timer-text" id="timer1">이</span>
                </div>
                <div class="timer-text-container">
                    <span class="timer-text" id="timer2">끾</span>
                </div>
                <div class="timer-text-container">
                    <span class="timer-text" id="timer3">끼</span>
                </div>
                <div class="timer-text-container timer-colon-container">
                    <span class="timer-text timer-colon">:</span>
                </div>
                <div class="timer-text-container">
                    <span class="timer-text" id="timer4"></span>
                </div>
                <div class="timer-text-container">
                    <span class="timer-text" id="timer5"></span>
                </div>
                <div class="timer-text-container timer-colon-container">
                    <span class="timer-text timer-colon">:</span>
                </div>
                <div class="timer-text-container">
                    <span class="timer-text" id="timer6"></span>
                </div>
                <div class="timer-text-container">
                    <span class="timer-text" id="timer7"></span>
                </div>
            </div>
            <div id="vacation-timer">
                <span id="vacation-timer-text">Rnlcksgdk</span>
            </div>
            <div id="second-display">
                <span id="second-display-text">214748</span>
            </div>
        </div>
        <div id="bottom-container">
            <div class="progress-bar" style="top:0" id="entire">
                <div class="circle circle-bright-before circle-dark-after entire-circle" style="left:3.846%;"></div>
                <div class="circle circle-dark-before circle-bright-after entire-circle" style="left:9.188%;"></div>
                <div class="circle circle-bright-before circle-dark-after entire-circle" style="left:24.359%;"></div>
                <div class="circle circle-dark-before circle-bright-after entire-circle" style="left:29.701%;"></div>
                <div class="circle circle-bright-before circle-dark-after entire-circle" style="left:44.872%;"></div>
                <div class="circle circle-dark-before circle-bright-after entire-circle" style="left:50.214%;"></div>
                <div class="circle circle-bright-before circle-dark-after entire-circle" style="left:65.385%;"></div>
                <div class="circle circle-dark-before circle-bright-after entire-circle" style="left:70.727%;"></div>
                <div class="circle circle-bright-before circle-dark-after entire-circle" style="left:85.897%;"></div>
                <div class="circle circle-dark-before circle-bright-after entire-circle" style="left:91.239%;"></div>
                <div class="circle circle-bright-before circle-bright-after entire-circle" style="left:100%;"></div>

                <div class="actual-bar"></div>
                <div class="dark-bar" style="width:5.342%;left:3.846%;"></div>
                <div class="dark-bar" style="width:5.342%;left:24.359%;"></div>
                <div class="dark-bar" style="width:5.342%;left:44.872%;"></div>
                <div class="dark-bar" style="width:5.342%;left:65.385%;"></div>
                <div class="dark-bar" style="width:5.342%;left:85.897%;"></div>
                <div class="circle circle-past" style="left:0%;"></div>
                
                <div class="past-bar" id="entire-past-bar"></div>
                <div class="circle circle-cursor" id="entire-cursor"></div>

                <div class="progress" id="entire-progress">yeye</div>
            </div>
            <div class="progress-bar" style="bottom:0" id="section">
                <div class="actual-bar"></div>
                <div class="dark-bar" id="section-dark" style="left:0"></div>
                <div class="circle circle-past" style="left:0%;"></div>
                <div id="section-circle" class="circle circle-bright-before circle-bright-after" style="left:100%;"></div>

                <div class="past-bar" id="section-past-bar"></div>
                <div class="circle circle-cursor" id="section-cursor"></div>

                <div class="progress" id="section-progress">yeat</div>
            </div>
        </div>
        <script>
            var x = window.setInterval(wait_for_exact,6);
            function wait_for_exact() {
                let a=(new Date().getMilliseconds())%100;
                if (a>=2&&a<=10) {
                    window.setInterval(update,100);
                    window.setTimeout(load,105);
                    window.clearInterval(x);
                }
            }

            function load() {
                $(":root").css("--dark-color","#DBCFBF");
                $(":root").css("--darker-color","#C2B7A9");
                $(":root").css("--darkest-color","#403C38");
            }

            function pad_zero(s,z) {
                s=s.toString();
                while (s.length<z) {
                    s="0"+s;
                }
                return s;
            }

            var long_time=new Date(2024,9,7,8,40,0,0);
            var freedom_time=new Date();
            freedom_time.setDate(
                freedom_time.getDate() + (7 - freedom_time.getDay() + 5) % 7
            );
            freedom_time.setHours(17);
            freedom_time.setMinutes(0);
            freedom_time.setSeconds(0);
            freedom_time.setMilliseconds(0);
            function update() {
                let now = new Date();
                let tar = Math.round((freedom_time-now)/100);
                let vtar = Math.round((long_time-now)/100);
                set_time(now, [Math.floor(tar/36000),Math.floor(tar/600)%60,(tar/10)%60]);
                // $("#vacation-timer-text").text(`${pad_zero(Math.floor(vtar/36000),4)}:${pad_zero(Math.floor(vtar/600)%60,2)}:${pad_zero(Math.floor(vtar/10)%60,2)}`)
            }

            var advance_seconds=[421200,405000,382500,318600,296100,232200,209700,145800,123300,59400,36900,0];
            var sunday_before_year = new Date(new Date().getFullYear(),0,0);
            sunday_before_year = sunday_before_year - sunday_before_year.getDay()*86400000;
            function set_time(now, time) {
                if (time[0]>=117) {
                    time=[117,0,0];
                } else if (time[0]<0) {
                    time=[0,0,0];
                }
                
                let seconds_left=time[0]*3600+time[1]*60+time[2];
                $("#second-display-text").text(Math.floor(seconds_left));
                $("#day-display-text").text(`${Math.floor(time[0]/24)};${time[0]%24}`)
                $("#hour-progress-fg").css("width",`${100-(time[1]/60+time[2]/3600)*100}%`)

                let entire_progress=100-(seconds_left)/421200*100;
                let ep_shard=pad_zero(Math.floor(entire_progress*1000).toString(),4);
                $("#entire-past-bar").css("width",`${entire_progress}%`);
                $("#entire-cursor").css("left",`${entire_progress}%`);
                $("#entire-progress").css("left",`${entire_progress}%`);
                $("#entire-progress").text(`${ep_shard.slice(0,-3)+"."+ep_shard.slice(-3)}%`)

                if (seconds_left>=421000) {
                    $(".entire-circle").removeClass("circle-past");
                    $("#section-circle").removeClass("circle-dark-before");
                    $("#section-circle").removeClass("circle-dark-after");
                }
                let i=1;
                while (seconds_left<=advance_seconds[i]) {
                    $(`.entire-circle:nth-child(${i})`).addClass("circle-past");
                    i++;
                }
                if (i%2==0) {
                    $("#section-dark").css("width","100%");
                    $("#section-circle").addClass("circle-dark-before");
                    $("#section-circle").addClass("circle-dark-after");
                } else {
                    $("#section-dark").css("width","0%");
                    $("#section-circle").removeClass("circle-dark-before");
                    $("#section-circle").removeClass("circle-dark-after");
                }
                let section_progress=0;
                if (advance_seconds[i-1]!=0) {
                    section_progress=(seconds_left-advance_seconds[i-1])/(advance_seconds[i]-advance_seconds[i-1])*100
                } else {
                    section_progress=100;
                }
                let sp_shard=pad_zero(Math.floor(section_progress*100).toString(),3);
                $("#section-past-bar").css("width",`${section_progress}%`);
                $("#section-cursor").css("left",`${section_progress}%`);
                $("#section-progress").css("left",`${section_progress}%`);
                $("#section-progress").text(`${sp_shard.slice(0,-2)+"."+sp_shard.slice(-2)}%`)

                for (i=3; i>0; i--) {
                    $(`#timer${i}`).text(Math.floor(time[0]%10));
                    time[0]/=10;
                }
                for (i=5; i>3; i--) {
                    $(`#timer${i}`).text(Math.floor(time[1]%10));
                    time[1]/=10;
                }
                for (i=7; i>5; i--) {
                    $(`#timer${i}`).text(Math.floor(time[2]%10));
                    time[2]/=10;
                }

                $("#date-display").text(`${now.getFullYear()}-${pad_zero(now.getMonth()+1, 2)}-${pad_zero(now.getDate(), 2)}`);
                let sunday_this_week = now-(now.getDay()*86400000);
                let diff = (sunday_this_week - sunday_before_year);
                let oneWeek = 1000 * 60 * 60 * 24 * 7;
                let week = Math.floor(diff / oneWeek);
                $("#week-display").text(`${week-8}주차`)
            }
        </script>
    </body>
</html>